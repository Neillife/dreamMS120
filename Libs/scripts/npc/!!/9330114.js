var status = -1;
var itemList = new Array(1452057, 1452059, 1452129, 1452130, 1452189, 1452102, 1452103, 1452104, 1462087, 1462088 ,1462089, 1462050, 1462051, 1462118, 1462119, 1462177, 1522015, 1522016, 1522020, 1522021);


var jobName = new Array(
"#b稀有物品", "#b高階物品", "#b所有物品","楓葉",
"展示裝", "展示武","展示套"
);

var NpcName = "弓箭手轉蛋機";
var NpcItems = 5220040;
var All_eq = 850; //所有裝備機率
var Vip_eq = 20; //特殊裝備機率
var Rare_eq = 1; //稀有裝備機率
var Scrolls = 3; //卷軸數量

var GachItem = new Array(
//弓箭手

[//稀有
1462121,1452132,
//革命
1452216,1462204,
//衣服
1003156,1003174,1003179,1003445,1003591,1003602,1003799,1004009,1004216,1004236,1004424,1042256,1050260,1050261,1050262,1050274,1050279,1051317,1051318,1051319,1051336,1051341,1052301,1052316,1052321,1052431,1052500,1052510,1052786,1052806,1052888,1062167,1070033,1070038,1070043,1070048,1070053,1071050,1071055,1071060,1071065,1071070,1072473,1072487,1072492,1072643,1072705,1072712,1072954,1072974,1073033,1082287,1082297,1082302,1082418,1082468,1082473,1082595,1082615,1082638,1102264,1102277,1102282,1102364,1102447,1102457,1102715,1102795,
//武器
1452229,1462239,1452252,1462213,1462193,1452205,1452226,1462202,1462161,1452214,1452172,1462194,1452206,1462177,1452189,1462214,1462099,1462191,1452111,1452203,1452227,1462241,1462207,1462188,1462189,1452255,1452219,1452200,1452201,1462140,1462160,1462175,1462195,1462139,1452150,1452171,1452188,1462226,1452207,1452149,1462100,1462152,1452239,1462094,1462146,1452112,1452162,1452107,1452156,1462125,1462145,1462153,1462198,1452136,1452155,1452163,1462178,1462186,1462222,1452210,1462124,1462144,1452190,1452198,1452235,1452135,1452154,1462123,1462143,1462180,1452134,1452153,1452192,1462192,1462197,1452204,1452209,1462122,1462142,1462179,1452133,1452152,1452191,1462208,1452220,1452071,1452232,1462219,
Rare_eq
],
[//The Vip
1462091,1452106,
//不速
1462090,1452105,1462089,1452104,1462088,1452103,1462087,1452102,
//9周年
1462196,1452208,
//混頓
1462107,1452119,1462106,1452118,1462105,1452117,
//游泳圈
1462209,1452221,
//130 140武器
1462225,1452238,1462224,1452237,
//正義
1462141,1452151,
//高階裝備
1004221,1052791,1072959,1082600,
1004226,1052796,1072964,1082605,
1004231,1052801,1072969,1082610,1102720,
Vip_eq
],
[//正常裝備
1002010,1002057,1002112,1002113,1002114,1002115,1002116,1002117,1002118,1002119,1002120,1002121,1002135,1002136,1002137,1002138,1002139,1002156,1002157,1002158,1002159,1002160,1002161,1002162,1002163,1002164,1002165,1002166,1002167,1002168,1002169,1002170,1002211,1002212,1002213,1002214,1002267,1002268,1002269,1002270,1002275,1002276,1002277,1002278,1002286,1002287,1002288,1002289,1002402,1002403,1002404,1002405,1002406,1002407,1002408,1002547,1003613,1003618,1040003,1040007,1040008,1040011,1040022,1040023,1040024,1040025,1040067,1040068,1040069,1040070,1040071,1040072,1040073,1040074,1040075,1040076,1040079,1040080,1040081,1041007,1041008,1041013,1041027,1041028,1041032,1041033,1041034,1041035,1041054,1041055,1041056,1041061,1041062,1041063,1041065,1041066,1041067,1041068,1041069,1041081,1041082,1041083,1050051,1050052,1050058,1050059,1050060,1050061,1050062,1050063,1050064,1050075,1050076,1050077,1050078,1050088,1050089,1050090,1050091,1050106,1050107,1050108,1051037,1051038,1051039,1051041,1051042,1051043,1051062,1051063,1051064,1051065,1051066,1051067,1051068,1051069,1051082,1051083,1051084,1051085,1051105,1051106,1051107,1052071,1052518,1052523,1060056,1060057,1060058,1060059,1060061,1060062,1060063,1060064,1060065,1060068,1060069,1060070,1060157,1060185,1061006,1061009,1061024,1061025,1061026,1061050,1061051,1061052,1061057,1061058,1061059,1061060,1061061,1061062,1061063,1061064,1061080,1061081,1061082,1062002,1062004,1062006,1072015,1072016,1072025,1072026,1072027,1072034,1072059,1072060,1072061,1072067,1072068,1072069,1072079,1072080,1072081,1072082,1072083,1072101,1072102,1072103,1072118,1072119,1072120,1072121,1072122,1072123,1072124,1072125,1072144,1072145,1072146,1072164,1072165,1072166,1072167,1072170,1072182,1072183,1072184,1072185,1072203,1072204,1072205,1072227,1072228,1072229,1072269,1072721,1072726,1082012,1082013,1082014,1082015,1082016,1082017,1082018,1082048,1082049,1082050,1082068,1082069,1082070,1082071,1082072,1082073,1082083,1082084,1082085,1082089,1082090,1082091,1082106,1082107,1082108,1082109,1082110,1082111,1082112,1082125,1082126,1082127,1082158,1082159,1082160,1082163,1082480,1082485,1112658,
//武器
1462065,1462223,1452072,1452236,1462039,1452044,1462015,1462016,1462017,1462104,1452019,1452020,1452021,1452116,1462018,1462021,1462022,1452017,1452025,1452026,1462020,1462010,1462011,1462012,1462013,1452012,1452013,1452014,1452015,1462009,1462103,1452009,1452010,1452011,1452115,1452018,1462008,1462074,1452004,1452082,1452023,1462007,1452008,1462006,1462102,1452007,1452114,1452166,1462005,1452006,1462004,1462041,1452005,1452046,1452167,1462000,1452000,1462003,1452001,1462002,1452003,1462001,1452024,1452002,
All_eq
],
[//楓葉展示
//綠寶石
1452125,1462113,
//白金
1452126,1462114,
1452016,1452022,1452045,1452100,1452123,1452124,1452128,1452147,1452165,1452170,1462014,1462019,1462040,1462085,1462111,1462112,1462116,1462136,1462156,1462159,
0
],
[//無法交易
1002992,1003034,1003199,1003299,1003304,1003309,1003313,1003318,1003323,1003328,1003333,1003338,1003343,1040146,1040161,1040164,1040168,1040171,1040173,1040175,1040178,1041149,1041163,1041166,1041170,1041173,1041176,1041179,1041181,1050165,1050202,1050204,1050206,1051204,1051246,1051248,1051250,1052272,1052335,1060135,1060151,1060161,1060163,1060166,1061157,1061173,1061176,1061180,1061185,1061188,1061190,1062146,1072401,1072422,1072504,1072561,1072566,1072571,1072576,1072581,1072586,1072591,1072596,1072601,1072606,1072734,1072739,1072745,1082259,1082307,1082348,1082353,1082358,1082363,1082368,1082373,1082378,1082383,1082388,1082545,1102473,1102478,1102483,1113239,
0
],
[//無法交易
1462237,1452250,1462215,1462206,1462240,1452228,1462120,1452218,1452253,1462190,1452131,1452202,1462203,1462183,1452215,1462185,1452195,1452197,1452101,1462076,1462086,1452058,1462027,1462032,1462804,1462904,1452031,1452036,1452804,1452904,1462187,1462026,1462031,1462137,1462182,1462803,1462903,1452199,1452030,1452035,1452194,1452803,1452903,1462063,1452090,1462025,1462030,1462096,1462162,1462902,1462097,1452029,1452034,1452109,1452173,1452902,1462059,1462060,1462061,1462062,1452110,1462135,1452066,1452067,1452068,1452069,1452099,1452146,1462084,1462174,1462024,1462029,1462095,1462134,1462181,1462901,1452070,1452187,1452028,1452033,1452108,1452145,1452193,1452901,1462043,1462133,1462802,1452048,1452144,1452802,1452234,1462221,1462132,1452027,1452032,1452073,1452092,1452143,1452900,1462023,1462028,1462077,1462131,1462801,1462900,1462056,1452801,1452142,1462066,1462130,1452062,1462044,1462045,1462075,1452049,1452050,1452096,1452141,1462081,1462129,1452085,1452037,1452140,1462128,1462800,1452084,1452091,1452093,1452139,1462078,1452800,1462127,1452138,1462126,1452051,1452137,1462092,1452083,
0
],
[//衣服稀有
1052650,//少一套裝
1003292,1052386,1072556,1082340,1102314,1003772,1052582,1072788,1082508,1102516,1004084,1052704,1072905,1082577,
0
]
);


var s = 0;

function action(mode, type, selection) {
	if (mode == -1) {
		cm.dispose();
	} else {
		if (mode == 0 && status == 0) {
			cm.dispose();
			return;
		}
		if (mode == 1)
			status++;
		else
			status--;
	}
    if (status == 0) {
		if (cm.haveItem(NpcItems, 1)) {
			var NoText = "";
			for (var q = 0; q < GachItem.length; q++) {
				if (q % 4 == 0) {
					NoText += "\r\n";
				}
				NoText += "#r#L" + q +"##e["+jobName[q]+"#r]#n#l";
			}
		} else {
			cm.sendOk("不好意思!您沒有#b#t"+NpcItems+"##i"+NpcItems+"##k。");
			cm.safeDispose();
		}
		cm.sendYesNo("[#b#p" +cm.getNpc()+"##k]："+GrandTotal()+"\r\n您身上有 #b#t"+NpcItems+"##i"+NpcItems+"##k 可以進行轉蛋。\r\n\r\n" +
			"#L"+(GachItem.length+1)+"##e#d你確定要使用嗎？#n#k#l\r\n" +
			"\r\n#r－－－－－－－－－－－－－－－－－－－－－－－－#k\r\n\r\n" +
			"#e查看本機台擁有..#n" + NoText + "#l　");
		s = selection;
	} else if (status == 1) {
		if (selection == (GachItem.length+1)) {
			var 機率 = 0;
			var tessa = "";
			var 不重複顯示共辜 =true;
			var 共辜 = true;
			for (var o = 0; o < GachItem.length; o++) {
				if (不重複顯示共辜) {
					機率 = GachItem[o][GachItem[o].length-1]
					tessa = cm.gainRewardItemqss(機率);
					if (tessa == "1") { //0 = 沒中, 1 = 中獎
						//中獎
						var RandomI = Math.floor(Math.random() * (GachItem[o].length-1));
						if (機率 == Rare_eq)
							item = cm.gainGachaponItem(GachItem[o][RandomI], 1, true, 2, "稀有");
						else if (機率 == Vip_eq)
							item = cm.gainGachaponItem(GachItem[o][RandomI], 1, false, 2, NpcName);
						else
							item = cm.gainGachaponItem(GachItem[o][RandomI], 1, false, 2, "");
						//檢查背包是否滿
						if (item != -1) {
							cm.gainItem(NpcItems, -1);
							if (不重複顯示共辜)
							cm.sendOk("#e您已獲得 #b#i" + item + ":#" + "  此裝備機率: " + 機率/10 + "%");
							cm.dispose();
						} else {
							cm.sendOk("#e檢查一下#b背包#r是否已滿#k");
							cm.dispose();
						}
						cm.safeDispose();
						//檢查背包是否滿
						break;//避免重複抽獎
						//中獎
					} else {
						if (o == (GachItem.length-1)){
							不重複顯示共辜 = false;
							var Scroll = cm.Scroll();
								if (Scroll != -2) {
									cm.sendOk("#e很可惜你並沒有中獎。\r\n將贈送安慰獎 #b#i" + Scroll + ":##t" + Scroll + "# "+Scrolls+" 張");
									cm.gainItem(NpcItems, -1);
									cm.gainItem(Scroll,Scrolls);
									cm.dispose();
								} else {
									cm.sendOk("#e請回報管理員物品代碼");
									cm.dispose();
								}
							cm.safeDispose();
						}
					}
				}
			}
		} else {
			var msg ="";
			for (var v = 0; v < GachItem[selection].length-1; v++) {
				if (v % 1 == 0) {
					msg += "\r\n";
				}
				if (cm.gainIItem(GachItem[selection][v]) == 0) {
					//msg += "#v" + GachItem[selection][v] + ":#" + GachItem[selection][v] + "	";
					msg += "#v" + GachItem[selection][v] + ":#" + GachItem[selection][v] +"	#t" + GachItem[selection][v] + ":#	";
				} else {
					msg += "#r#fUI/UIWindow.img/QuestIcon/5/0# (無名稱)#k	";
				}
			}
			cm.sendOk("#e本機台擁有 #r" + (GachItem[selection].length-1)+ "#k 個#n\r\n" + msg);
			cm.dispose();
		}
	

    }
}

function GrandTotal(){
	var Sum =0;
for (var v = 0; v < GachItem.length; v++) {
	for (var i = 0; i < GachItem[v].length-1; i++) {
		Sum += 1;
	}
}
    return Sum;
}
