var status = -1;
var GachItem = new Array(
				[4030000,10000,true],
				[4030001,100,true]
				);
				//物品ID,機率,是否上廣
var itemList = new Array(1332053,1332028,1472054,1472031,2070005,1332026,1332052,1332051,1332050,1472051,1472052,2070006,1092049,1092050);




var jobName = new Array(
"#b稀有物品", "#b高階物品", "#b所有物品","楓葉",
"展示裝", "展示武","展示套"
);

var NpcName = "盜賊轉蛋機";
var NpcItems = 5220040;
var All_eq = 850; //所有裝備機率
var Vip_eq = 20; //特殊裝備機率
var Rare_eq = 1; //稀有裝備機率
var Scrolls = 3; //卷軸數量

var GachItem = new Array(
//盜賊
[//稀有
1332153,1342042,1472144,
//革命
1332238,1472226,
//裝備
1003157,1003175,1003180,1003446,1003592,1003604,1003800,1004008,1004217,1004237,1004425,1042257,1050266,1050267,1050268,1050276,1050281,1051323,1051324,1051325,1051338,1051343,1052302,1052317,1052322,1052432,1052501,1052512,1052787,1052807,1052889,1062168,1070035,1070040,1070045,1070050,1070055,1071052,1071057,1071062,1071067,1071072,1072474,1072488,1072493,1072644,1072706,1072714,1072955,1072975,1073034,1082288,1082298,1082303,1082419,1082469,1082475,1082596,1082616,1082639,1092088,1102265,1102278,1102283,1102365,1102448,1102459,1102716,1102796,
//武器
1332274,1332247,1332225,1332235,1332195,1332226,1332205,1332249,1332130,1332223,1332277,1332241,1332220,1332221,1332194,1332204,1332227,1332261,1332171,1332131,1332170,1332184,1332177,1332126,1332230,1332157,1332176,1332187,1472261,1332207,1332216,1332257,1332156,1332175,1342101,1472235,1332155,1332174,1332209,1332229,1332154,1332173,1332208,1342090,1472214,1332242,1342082,1472223,1472181,1342084,1472215,1472197,1342083,1472236,1472263,1342075,1472122,1472212,1342091,1472229,1342036,1342074,1342081,1472180,1472196,1472209,1472210,1342053,1342100,1472216,1472161,1342035,1342064,1472123,1472174,1472248,1342059,1472118,1472162,1472168,1332254,1342046,1342058,1342066,1472219,1342045,1342057,1342092,1342097,1342103,1472175,1472148,1472167,1472244,1342044,1342056,1342077,1342043,1342055,1342076,1472147,1472166,1472198,1472207,1342087,1472146,1472165,1472200,1472213,1472218,1472145,1472164,1472199,1472230,1342094,1472086,1472241,1472243,
Rare_eq
],
[//The Vip
1332120,1342033,1472117,
//不速
1332119,1332118,1332117,1332116,1342032,1472116,1342031,1472115,1342029,1472114,1472113,
//9周年
1332228,1472217,1342030,
//混沌
1332138,1332137,1332136,1472130,1472129,1472128,
//游泳圈
1332243,1472231,
//130 140裝
1332260,1332259,1472247,1342099,1342098,1472246,
//正義
1332172,1342054,1472163,1342009,
//高階裝備
1004222,1052792,1072960,1082601,
1004227,1052797,1072965,1082606,
1004232,1052802,1072970,1082611,1102721,
Vip_eq
],
[//正常裝備
1002107,1002108,1002109,1002110,1002111,1002122,1002123,1002124,1002125,1002126,1002127,1002128,1002129,1002130,1002131,1002146,1002147,1002148,1002149,1002150,1002171,1002172,1002173,1002174,1002175,1002176,1002177,1002178,1002179,1002180,1002181,1002182,1002183,1002184,1002185,1002207,1002208,1002209,1002210,1002247,1002248,1002249,1002281,1002282,1002283,1002284,1002285,1002323,1002324,1002325,1002326,1002327,1002328,1002329,1002330,1002380,1002381,1002382,1002383,1002550,1002656,1003614,1003619,1040031,1040032,1040033,1040034,1040035,1040042,1040043,1040044,1040048,1040049,1040050,1040057,1040058,1040059,1040060,1040061,1040062,1040063,1040082,1040083,1040084,1040094,1040095,1040096,1040097,1040098,1040099,1040100,1040105,1040106,1040107,1040108,1040109,1040110,1040115,1040116,1040117,1040118,1040179,1041003,1041036,1041037,1041038,1041039,1041040,1041044,1041045,1041047,1041048,1041049,1041050,1041057,1041058,1041059,1041060,1041074,1041075,1041076,1041077,1041078,1041079,1041080,1041094,1041095,1041096,1041100,1041101,1041102,1041103,1041105,1041106,1041107,1041115,1041116,1041117,1041118,1050096,1050097,1050098,1050099,1051006,1051007,1051008,1051009,1051090,1051091,1051092,1051093,1052072,1052519,1052524,1060021,1060022,1060023,1060024,1060025,1060031,1060032,1060033,1060037,1060038,1060039,1060043,1060044,1060045,1060046,1060050,1060051,1060052,1060071,1060072,1060073,1060083,1060084,1060085,1060086,1060087,1060088,1060089,1060093,1060094,1060095,1060097,1060098,1060099,1060104,1060105,1060106,1060107,1060167,1060184,1061003,1061029,1061030,1061031,1061032,1061033,1061037,1061038,1061040,1061041,1061042,1061043,1061044,1061045,1061046,1061053,1061054,1061055,1061056,1061069,1061070,1061071,1061076,1061077,1061078,1061079,1061093,1061094,1061095,1061099,1061100,1061101,1061102,1061104,1061105,1061106,1061114,1061115,1061116,1061117,1072022,1072028,1072029,1072030,1072031,1072032,1072033,1072035,1072036,1072065,1072066,1072070,1072071,1072084,1072085,1072086,1072087,1072104,1072105,1072106,1072107,1072108,1072109,1072110,1072128,1072129,1072130,1072131,1072150,1072151,1072152,1072161,1072162,1072163,1072171,1072172,1072173,1072174,1072192,1072193,1072194,1072195,1072213,1072214,1072215,1072216,1072272,1072722,1072727,1082029,1082030,1082031,1082032,1082033,1082034,1082037,1082038,1082039,1082042,1082043,1082044,1082045,1082046,1082047,1082065,1082066,1082067,1082074,1082075,1082076,1082092,1082093,1082094,1082095,1082096,1082097,1082118,1082119,1082120,1082135,1082136,1082137,1082138,1082142,1082143,1082144,1082167,1082481,1082486,1092018,1092019,1092020,1092049,1092050,
//武器
1332258,1332050,1332052,1332135,1332231,1332027,1332028,1332168,1332023,1332018,1332134,1332098,1332015,1332024,1332003,1332054,1472087,1332011,1332031,1332133,1342010,1472245,1342008,1332014,1472051,1472052,1342007,1332001,1342006,1472127,1472053,1332012,1332057,1342005,1332004,1472033,1342004,1472159,1472031,1332013,1342003,1472026,1472027,1472028,1472029,1472126,1312002,1332002,1342002,1472022,1472023,1472024,1472025,1472099,1472054,1302001,1332000,1472018,1472019,1472020,1472021,1342001,1472014,1472015,1472016,1472017,1472125,1342000,1472011,1472012,1472013,1472008,1472009,1472010,1472007,1472004,1472005,1472006,1472001,1472002,1472003,1472056,1472000,
All_eq
],
[//楓葉展示
//綠寶石
1332144,1472136,
//白金
1332145,1472137,
1332025,1332055,1332056,1332114,1332142,1332143,1332147,1332186,1332193,1342025,1342026,1342027,1342028,1342037,1342038,1342039,1472030,1472032,1472055,1472111,1472134,1472135,1472139,1472177,1472179,
0
],
[//無法交易
1002993,1003033,1003200,1003300,1003305,1003310,1003314,1003319,1003324,1003329,1003334,1003339,1003344,1040147,1040162,1040165,1040169,1040172,1040174,1040176,1040181,1040183,1040185,1041150,1041164,1041167,1041171,1041174,1041177,1041182,1041184,1041186,1041188,1050166,1051205,1051243,1052244,1052273,1052336,1060136,1060152,1060154,1060158,1060160,1060162,1060164,1060169,1060171,1060173,1061158,1061174,1061177,1061181,1061183,1061186,1061191,1061193,1061195,1061197,1072402,1072421,1072505,1072562,1072567,1072572,1072577,1072582,1072587,1072592,1072597,1072602,1072607,1072735,1072740,1072746,1082258,1082308,1082349,1082354,1082359,1082364,1082369,1082374,1082379,1082384,1082389,1082546,1092107,1102474,1102479,1102484,1113240,
0
],
[//無法交易
1332272,1332250,1332240,1332275,1332152,1332222,1332271,1332215,1332212,1332115,1332100,1332037,1332042,1332804,1332904,1342095,1332087,1332196,1332211,1332036,1332041,1332803,1332903,1332110,1332128,1332035,1332040,1332085,1332902,1332129,1332081,1332167,1332203,1332034,1332039,1332127,1332166,1332901,1342071,1332111,1472259,1332059,1472237,1332210,1342093,1332256,1332165,1332802,1472228,1472262,1342080,1472211,1472143,1472224,1332033,1332038,1332088,1332103,1332164,1332900,1472258,1342020,1342089,1342102,1472203,1342019,1472112,1332163,1332801,1342096,1472110,1472206,1472069,1332107,1332060,1332061,1332162,1342034,1342088,1472208,1342052,1342073,1472038,1472043,1472804,1472904,1332161,1342022,1472202,1332099,1342051,1472101,1472037,1472042,1472084,1472803,1472903,1472120,1472182,1332102,1332104,1332160,1472121,1472036,1472041,1472083,1472195,1472902,1332800,1342050,1472158,1332159,1342018,1342021,1342049,1472035,1472040,1472901,1472119,1472157,1472201,1332063,1472058,1332158,1342078,1472802,1472156,1342048,1472034,1472039,1472107,1472900,1472103,1472155,1472801,1342047,1472077,1472089,1472154,1472100,1472153,1472104,1472044,1472152,1472102,1472151,1472800,1472059,1472060,1472150,1472061,1472149,
0
],
[//衣服稀有
1092047,
1052651,//少一套裝
1003293,1052387,1072557,1082341,1102315,1003773,1052583,1072789,1082509,1102517,1004085,1052705,1072906,1082578,
0
],
[
1332169,1332237,1342085,1382144,1402130,1422090,1432118,1452148,1462138,1472160,1482121,1492121,
0
]
);


var s = 0;

function action(mode, type, selection) {
	if (mode == -1) {
		cm.dispose();
	} else {
		if (mode == 0 && status == 0) {
			cm.dispose();
			return;
		}
		if (mode == 1)
			status++;
		else
			status--;
	}
    if (status == 0) {

		if (cm.haveItem(NpcItems, 1)) {
			var NoText = "";
			for (var q = 0; q < GachItem.length; q++) {
				if (q % 4 == 0) {
					NoText += "\r\n";
				}
				NoText += "#r#L" + q +"##e["+jobName[q]+"#r]#n#l";
			}
		} else {
			cm.sendOk("不好意思!您沒有#b#t"+NpcItems+"##i"+NpcItems+"##k。");
			cm.safeDispose();
		}
		cm.sendYesNo("[#b#p" +cm.getNpc()+"##k]："+GrandTotal()+"\r\n您身上有 #b#t"+NpcItems+"##i"+NpcItems+"##k 可以進行轉蛋。\r\n\r\n" +
			"#L"+(GachItem.length+1)+"##e#d你確定要使用嗎？#n#k#l\r\n" +
			"\r\n#r－－－－－－－－－－－－－－－－－－－－－－－－#k\r\n\r\n" +
			"#e查看本機台擁有..#n" + NoText + "#l　");
		s = selection;
	} else if (status == 1) {
		if (selection == (GachItem.length+1)) {
			var 機率 = 0;
			var tessa = "";
			var 不重複顯示共辜 =true;
			var 共辜 = true;
			for (var o = 0; o < GachItem.length; o++) {
				if (不重複顯示共辜) {
					機率 = GachItem[o][GachItem[o].length-1]
					tessa = cm.gainRewardItemqss(機率);
					if (tessa == "1") { //0 = 沒中, 1 = 中獎
						//中獎
						var RandomI = Math.floor(Math.random() * (GachItem[o].length-1));
						if (機率 == Rare_eq)
							item = cm.gainGachaponItem(GachItem[o][RandomI], 1, true, 2, "稀有");
						else if (機率 == Vip_eq)
							item = cm.gainGachaponItem(GachItem[o][RandomI], 1, false, 2, NpcName);
						else
							item = cm.gainGachaponItem(GachItem[o][RandomI], 1, false, 2, "");
						//檢查背包是否滿
						if (item != -1) {
							cm.gainItem(NpcItems, -1);
							if (不重複顯示共辜)
							cm.sendOk("#e您已獲得 #b#i" + item + ":#" + "  此裝備機率: " + 機率/10 + "%");
							cm.dispose();
						} else {
							cm.sendOk("#e檢查一下#b背包#r是否已滿#k");
							cm.dispose();
						}
						cm.safeDispose();
						//檢查背包是否滿
						break;//避免重複抽獎
						//中獎
					} else {
						if (o == (GachItem.length-1)){
							不重複顯示共辜 = false;
							var Scroll = cm.Scroll();
								if (Scroll != -2) {
									cm.sendOk("#e很可惜你並沒有中獎。\r\n將贈送安慰獎 #b#i" + Scroll + ":##t" + Scroll + "# "+Scrolls+" 張");
									cm.gainItem(NpcItems, -1);
									cm.gainItem(Scroll,Scrolls);
									cm.dispose();
								} else {
									cm.sendOk("#e請回報管理員物品代碼");
									cm.dispose();
								}
							cm.safeDispose();
						}
					}
				}
			}
		} else {
			var msg ="";
			for (var v = 0; v < GachItem[selection].length-1; v++) {
				if (v % 1 == 0) {
					msg += "\r\n";
				}
				if (cm.gainIItem(GachItem[selection][v]) == 0) {
					//msg += "#v" + GachItem[selection][v] + ":#" + GachItem[selection][v] + "	";
					msg += "#v" + GachItem[selection][v] + ":#" + GachItem[selection][v] +"	#t" + GachItem[selection][v] + ":#	";
				} else {
					msg += "#r#fUI/UIWindow.img/QuestIcon/5/0# (無名稱)#k	";
				}
			}
			cm.sendOk("#e本機台擁有 #r" + (GachItem[selection].length-1)+ "#k 個#n\r\n" + msg);
			cm.dispose();
		}
	

    }
}

function GrandTotal(){
	var Sum =0;
for (var v = 0; v < GachItem.length; v++) {
	for (var i = 0; i < GachItem[v].length-1; i++) {
		Sum += 1;
	}
}
    return Sum;
}