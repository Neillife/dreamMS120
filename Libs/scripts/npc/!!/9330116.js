var status = -1;
var GachItem = new Array(
				[4030000,10000,true],
				[4030001,100,true]
				);
				//物品ID,機率,是否上廣
var itemList = new Array(
	1482052, 
	1482010, 
	1492011, 
	1492012, 
	1482013, 
	1492013
);


var jobName = new Array(
"#b稀有物品", "#b高階物品", "#b所有物品","楓葉",
"展示裝", "展示武","展示套"
);

var NpcName = "海盜轉蛋機";
var NpcItems = 5220040;
var All_eq = 850; //所有裝備機率
var Vip_eq = 20; //特殊裝備機率
var Rare_eq = 1; //稀有裝備機率
var Scrolls = 3; //卷軸數量

var GachItem = new Array(
//海盜
[//稀有
1482105,1492104,
//革命
1482179,1492190,
//裝備
1003158,1003176,1003181,1003447,1003593,1003605,1003801,1004010,1004218,1004238,1004426,1042258,1050269,1050270,1050271,1050277,1050282,1051326,1051327,1051328,1051339,1051344,1052303,1052318,1052323,1052433,1052502,1052513,1052788,1052808,1052890,1062169,1070036,1070041,1070046,1070051,1070056,1071053,1071058,1071063,1071068,1071073,1072475,1072489,1072494,1072645,1072707,1072715,1072956,1072976,1073035,1082289,1082299,1082304,1082420,1082470,1082476,1082597,1082617,1082640,1102266,1102279,1102284,1102366,1102449,1102460,1102717,1102797,
//武器
1482216,1492231,1482189,1492199,1482168,1492179,1482177,1482142,1492188,1492154,1482169,1492180,1482151,1492162,1482190,1492200,1482084,1482166,1482218,1492085,1492177,1482182,1492233,1482163,1482164,1492193,1492174,1492175,1482141,1482150,1482122,1482170,1492153,1492160,1482123,1482203,1492122,1492123,1492181,1492213,1482085,1482135,1482080,1482129,1492086,1492135,1492081,1492129,1482173,1482109,1482128,1482136,1492108,1492128,1492136,1492184,1482199,1492209,1482152,1482161,1492163,1492172,1482108,1482127,1492107,1492127,1482107,1482126,1482154,1492106,1492126,1492165,1482167,1482172,1492178,1492183,1482106,1482125,1482153,1492105,1492125,1492164,1482183,1492194,1492037,1492205,1482196,
Rare_eq
],
[//The Vip
1482079,1492079,
//不速
1482078,1492078,1482077,1492077,1482076,1492076,1482075,1492075,
//9周年
1482171,1492182,
//混沌
1482092,1492090,1482091,1492089,1482090,1492088,
//游泳圈
1482184,1492195,
//130 140裝
1482202,1492212,1482201,1492211,
//正義
1482124,1492124,1492151,
//高階裝備
1004223,1052793,1072961,1082602,
1004228,1052798,1072966,1082607,
1004233,1052803,1072971,1082612,1102722,
Vip_eq
],
[//正常裝備
1002610,1002613,1002616,1002619,1002622,1002625,1002628,1002631,1002634,1002637,1002640,1002643,1002646,1002649,1003615,1003620,1050313,1052095,1052098,1052101,1052104,1052107,1052110,1052113,1052116,1052119,1052122,1052125,1052128,1052131,1052134,1052397,1052520,1052525,1052712,1072285,1072288,1072291,1072294,1072297,1072300,1072303,1072306,1072309,1072312,1072315,1072318,1072321,1072338,1072723,1072728,1082180,1082183,1082186,1082189,1082192,1082195,1082198,1082201,1082204,1082207,1082210,1082213,1082216,1082248,1082482,1082487,
//武器
1482200,1492210,1482013,1492013,1482089,1482012,1492012,1482011,1492011,1482120,1492119,1482010,1492010,1482009,1482088,1492009,1482008,1492008,1482007,1482030,1492034,1492007,1482006,1482087,1482065,1492006,1482005,1492065,1492005,1482004,1492004,1482003,1492003,1482002,1482001,1492002,1482000,1492001,1492000,
All_eq
],
[//楓葉展示
//綠寶石
1482098,1492097,
//白金
1482099,1492098,
1482020,1482021,1482022,1482073,1482096,1482097,1482101,1482138,1482140,1492020,1492021,1492022,1492073,1492152,1492096,1492138,1492100,1492095,
0
],
[//無法交易
1002994,1003035,1003201,1003301,1003306,1003311,1003315,1003320,1003325,1003330,1003335,1003340,1003345,1052208,1052235,1052274,1052337,1052389,1052390,1052391,1052392,1052393,1052394,1052395,1052396,1052398,1072403,1072423,1072506,1072563,1072568,1072573,1072578,1072583,1072588,1072593,1072598,1072603,1072608,1072736,1072741,1072747,1082260,1082309,1082350,1082355,1082360,1082365,1082370,1082375,1082380,1082385,1082390,1082547,1102475,1102480,1102485,1112784,1113095,1113241,
0
],
[//無法交易
1482214,1492224,1482192,1492201,1482181,1482217,1482104,1492103,1492192,1492232,1482165,1492176,1482178,1492189,1482157,1482213,1492168,1492223,1482160,1492171,1482051,1482057,1482062,1492024,1492057,1492062,1482056,1482061,1482074,1482162,1492056,1492061,1492074,1492173,1482156,1492120,1492167,1482052,1482055,1482060,1492055,1492060,1482025,1482032,1482143,1492026,1492036,1492155,1482082,1492083,1482083,1492084,1482031,1492035,1482072,1482119,1492072,1492118,1482054,1482059,1482149,1492159,1492054,1492059,1482081,1482118,1482155,1492082,1492117,1492166,1482117,1492116,1482028,1492029,1482053,1482058,1482037,1482064,1482116,1492053,1492058,1482198,1492038,1492064,1492115,1492208,1482029,1482115,1482027,1492030,1492114,1482114,1492028,1482046,1482069,1492113,1482113,1492069,1492048,1492112,1482063,1482066,1482112,1482026,1482111,1492063,1492066,1492111,1482014,1492027,1482110,1492110,1492014,1492109,
0
],
[//衣服稀有
1052652,1003294,1052388,1072558,1082342,1102316,1003774,1052584,1072790,1082510,1102518,1004086,1052706,1072907,1082579,1003691,1052547,1072697,1082492,1102500,
0
]
);


var s = 0;

function action(mode, type, selection) {
	if (mode == -1) {
		cm.dispose();
	} else {
		if (mode == 0 && status == 0) {
			cm.dispose();
			return;
		}
		if (mode == 1)
			status++;
		else
			status--;
	}
    if (status == 0) {
		if (cm.haveItem(NpcItems, 1)) {
			var NoText = "";
			for (var q = 0; q < GachItem.length; q++) {
				if (q % 4 == 0) {
					NoText += "\r\n";
				}
				NoText += "#r#L" + q +"##e["+jobName[q]+"#r]#n#l";
			}
		} else {
			cm.sendOk("不好意思!您沒有#b#t"+NpcItems+"##i"+NpcItems+"##k。");
			cm.safeDispose();
		}
		cm.sendYesNo("[#b#p" +cm.getNpc()+"##k]："+GrandTotal()+"\r\n您身上有 #b#t"+NpcItems+"##i"+NpcItems+"##k 可以進行轉蛋。\r\n\r\n" +
			"#L"+(GachItem.length+1)+"##e#d你確定要使用嗎？#n#k#l\r\n" +
			"\r\n#r－－－－－－－－－－－－－－－－－－－－－－－－#k\r\n\r\n" +
			"#e查看本機台擁有..#n" + NoText + "#l　");
		s = selection;
	} else if (status == 1) {
		if (selection == (GachItem.length+1)) {
			var 機率 = 0;
			var tessa = "";
			var 不重複顯示共辜 =true;
			var 共辜 = true;
			for (var o = 0; o < GachItem.length; o++) {
				if (不重複顯示共辜) {
					機率 = GachItem[o][GachItem[o].length-1]
					tessa = cm.gainRewardItemqss(機率);
					if (tessa == "1") { //0 = 沒中, 1 = 中獎
						//中獎
						var RandomI = Math.floor(Math.random() * (GachItem[o].length-1));
						if (機率 == Rare_eq)
							item = cm.gainGachaponItem(GachItem[o][RandomI], 1, true, 2, "稀有");
						else if (機率 == Vip_eq)
							item = cm.gainGachaponItem(GachItem[o][RandomI], 1, false, 2, NpcName);
						else
							item = cm.gainGachaponItem(GachItem[o][RandomI], 1, false, 2, "");
						//檢查背包是否滿
						if (item != -1) {
							cm.gainItem(NpcItems, -1);
							if (不重複顯示共辜)
							cm.sendOk("#e您已獲得 #b#i" + item + ":#" + "  此裝備機率: " + 機率/10 + "%");
							cm.dispose();
						} else {
							cm.sendOk("#e檢查一下#b背包#r是否已滿#k");
							cm.dispose();
						}
						cm.safeDispose();
						//檢查背包是否滿
						break;//避免重複抽獎
						//中獎
					} else {
						if (o == (GachItem.length-1)){
							不重複顯示共辜 = false;
							var Scroll = cm.Scroll();
								if (Scroll != -2) {
									cm.sendOk("#e很可惜你並沒有中獎。\r\n將贈送安慰獎 #b#i" + Scroll + ":##t" + Scroll + "# "+Scrolls+" 張");
									cm.gainItem(NpcItems, -1);
									cm.gainItem(Scroll,Scrolls);
									cm.dispose();
								} else {
									cm.sendOk("#e請回報管理員物品代碼");
									cm.dispose();
								}
							cm.safeDispose();
						}
					}
				}
			}
		} else {
			var msg ="";
			for (var v = 0; v < GachItem[selection].length-1; v++) {
				if (v % 1 == 0) {
					msg += "\r\n";
				}
				if (cm.gainIItem(GachItem[selection][v]) == 0) {
					//msg += "#v" + GachItem[selection][v] + ":#" + GachItem[selection][v] + "	";
					msg += "#v" + GachItem[selection][v] + ":#" + GachItem[selection][v] +"	#t" + GachItem[selection][v] + ":#	";
				} else {
					msg += "#r#fUI/UIWindow.img/QuestIcon/5/0# (無名稱)#k	";
				}
			}
			cm.sendOk("#e本機台擁有 #r" + (GachItem[selection].length-1)+ "#k 個#n\r\n" + msg);
			cm.dispose();
		}
	

    }
}

function GrandTotal(){
	var Sum =0;
for (var v = 0; v < GachItem.length; v++) {
	for (var i = 0; i < GachItem[v].length-1; i++) {
		Sum += 1;
	}
}
    return Sum;
}
