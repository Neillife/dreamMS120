var status = -1;

var itemList = new Array(2040317, 3010013, 2000005, 2022113, 2043201, 2044001, 2041038, 2041039, 2041036, 2041037, 2041040, 2041041, 2041026, 2041027, 2044600, 2043301, 2040308, 2040309, 2040304, 2040305, 2040810, 2040811, 2040812, 2040813, 2040814, 2040815, 2040008, 2040009, 2040010, 2040011, 2040012, 2040013, 2040510, 2040511, 2040508, 2040509, 2040518, 2040519, 2040520, 2040521, 2044401, 2040900, 2040902, 2040908, 2040909, 2044301, 2040406, 2040407, 1302026, 2000005, 2022113, 2002018, 1382001, 1050008, 1442017, 1002084, 1050003, 1002064, 1061006, 1051027, 1442009, 1050056, 1051047, 1050049, 1040080, 1051055, 1372010, 1422005, 1002143, 1302027, 1061087, 1372003, 1302019, 1051023, 1050054, 1061083, 1051017, 1002028, 1322010, 1332013, 1050055, 1002245, 2022176, 2022113, 2043202, 2043201, 2044102, 2044101, 2040602, 2040601, 2043302, 2043301, 2040002, 2040001, 2044402, 2002017, 1402010, 1312014, 1442017, 1002063, 1060062, 1050018, 1002392, 1040037, 1002160, 1060005, 1332009, 1332008, 1442009, 1302004, 1312006, 1002154, 1002175, 1060064, 1061088, 1402012, 1002024, 1312005, 1432002, 1302050, 1002048, 1040061, 1041067, 1002131, 1072263, 1332001, 1312027, 1322015, 1432006, 1041088, 1061087, 1402013, 1302051, 1002023, 1402006, 1322000, 1372002, 1442001, 1422004, 1432003, 1040088, 1002100, 1041004, 1061047, 1322022, 1040021, 1061091, 1102012, 1050006, 1060018, 1041044, 1041024, 1041087, 1082146, 1332043, 1062001, 1051014, 1402030, 1432004, 1060060, 1432018, 1002096, 1442010, 1422003, 1472014, 1002021, 1060060, 1442031, 1402000, 1040089, 1432005, 5062002, 5062003, 5062005, 2340000, 2049100, 3010014, 3010043, 3010073, 3010072, 3010068, 3010085, 3010118, 3010124, 3010125, 3010131, 3010137, 3010156, 3010615, 3010592, 3010602, 3010670, 3010728, 1342033, 1372078, 1382099, 1402090, 1412062, 1422063, 1432081, 1442111, 1452106, 1462091, 1472117, 1482079, 1492079, 1302147, 1312062, 1322090, 1332120, 1332125, 1102041, 1022082, 1072238, 2040834);

var itemList10_60 = new Array(
//所有 10% 60% 卷 
2040001,2040002,2040004,2040005,2040016,2040017,2040025,2040026,2040029,2040031,2040100,2040101,2040105,2040106,2040200,2040201,2040201,2040205,2040206,2040301,2040302,2040303,2040310,2040311,2040317,2040318,2040321,2040323,2040326,2040328,2040329,2040330,2040331,2040401,2040402,2040412,2040413,2040418,2040419,2040421,2040422,2040425,2040427,2040501,2040502,2040504,2040505,2040513,2040514,2040516,2040517,2040532,2040534,2040601,2040602,2040612,2040613,2040618,2040619,2040621,2040622,2040625,2040627,2040701,2040702,2040704,2040705,2040707,2040708,2040801,2040802,2040804,2040805,2040816,2040817,2040824,2040825,2040826,2040901,2040902,2040914,2040915,2040919,2040920,2040924,2040925,2040927,2040928,2040931,2040933,2041001,2041002,2041004,2041005,2041007,2041008,2041010,2041011,2041013,2041014,2041016,2041017,2041019,2041020,2041022,2041023,2041058,2041101,2041102,2041104,2041105,2041107,2041108,2041110,2041111,2041201,2041202,2041206,2041207,2041301,2041302,2041304,2041305,2041307,2041308,2041310,2041311,2043001,2043002,2043008,2043009,2043017,2043019,2043021,2043101,2043102,2043112,2043114,2043116,2043201,2043202,2043212,2043214,2043216,2043301,2043302,2043311,2043401,2043402,2043701,2043702,2043711,2043714,2043801,2043802,2043811,2043814,2044001,2044002,2044012,2044014,2044015,2044024,2044101,2044102,2044112,2044114,2044116,2044201,2044202,2044212,2044214,2044216,2044301,2044302,2044312,2044314,2044316,2044401,2044402,2044403,2044412,2044414,2044416,2044501,2044502,2044511,2044601,2044602,2044611,2044701,2044702,2044711,2044801,2044802,2044807,2044809,2044816,2044901,2044902,2044909,2048001,2048002,2048004,2048005,2048010,2048011,2048012,2048013,2048014,2048015,2048016,2048017,2048018,2048019
);
var itemList30_70 = new Array(
//詛咒捲
2040008,2040009,2040010,2040011,2040012,2040013,2040014,2040015,2040028,2040030,2040103,2040104,2040108,2040109,2040203,2040204,2040208,2040209,2040304,2040305,2040306,2040307,2040308,2040309,2040320,2040322,2040325,2040327,2040404,2040405,2040406,2040407,2040408,2040409,2040410,2040411,2040424,2040426,2040508,2040509,2040510,2040511,2040518,2040519,2040520,2040521,2040531,2040533,2040604,2040605,2040606,2040607,2040608,2040609,2040610,2040611,2040624,2040626,2040712,2040713,2040714,2040715,2040716,2040717,2040808,2040809,2040810,2040811,2040812,2040813,2040814,2040815,2040904,2040905,2040906,2040907,2040908,2040909,2040916,2040917,2040921,2040922,2040930,2040932,2041026,2041027,2041028,2041029,2041030,2041031,2041032,2041033,2041034,2041035,2041036,2041037,2041038,2041039,2041040,2041041,2041112,2041113,2041114,2041115,2041116,2041117,2041118,2041119,2041120,2041121,2041122,2041123,2041124,2041125,2041126,2041127,2041128,2041129,2041204,2041205,2041209,2041210,2041312,2041313,2041314,2041315,2041316,2041317,2041318,2041319,2043004,2043005,2043006,2043007,2043016,2043018,2043104,2043105,2043111,2043113,2043204,2043205,2043211,2043213,2043304,2043305,2043704,2043705,2043804,2043805,2044004,2044005,2044011,2044013,2044104,2044105,2044111,2044113,2044204,2044205,2044211,2044213,2044304,2044305,2044311,2044313,2044404,2044405,2044411,2044413,2044504,2044505,2044604,2044605,2044704,2044705,2044803,2044804,2044806,2044808,2044903,2044904,2046004,2046005,2046104,2046105,2046208,2046209,2046210,2046211,2046212
);
var itemList15_65 = new Array(
//15-65無法交易卷
2040020,2041054,2040019,2040021,2040022,2040043,2040044,2040313,2040314,2040335,2040336,2040337,2040338,2040339,2040340,2040415,2040416,2040431,2040432,2040433,2040434,2040435,2040436,2040522,2040523,2040524,2040525,2040526,2040527,2040528,2040529,2040540,2040541,2040615,2040616,2040631,2040632,2040633,2040634,2040635,2040636,2040718,2040719,2040720,2040721,2040722,2040723,2040819,2040820,2040821,2040822,2040831,2040832,2040910,2040911,2040937,2040938,2040939,2040940,2040941,2040942,2041042,2041043,2041044,2041045,2041046,2041047,2041048,2041049,2041050,2041051,2041052,2041053,2041056,2041055,2041057,2043011,2043012,2043024,2043025,2043106,2043107,2043118,2043119,2043206,2043207,2043218,2043219,2043306,2043307,2043403,2043404,2043706,2043707,2043806,2043807,2044006,2044007,2044026,2044027,2044106,2044107,2044118,2044119,2044206,2044207,2044218,2044219,2044306,2044307,2044318,2044319,2044406,2044407,2044418,2044419,2044506,2044507,2044606,2044607,2044706,2044707,2044811,2044812,2044813,2044814,2044906,2044907,2048006,2048007,2048008,2048009
);

	var 累計一班 = 0;
	var 累計稀有 = 0;

function log10(val) {
	return Math.log(val) / Math.LN10;
}
function GodtotalWeight(){
	var GodWeights = Array("一班","稀有");
	var GodWeight = Array(1,3);
	var Godprobability = [GodWeight.length];
	var totalWeight = 0;
	var itemId = 0;
	while(lottery != true){
		for(var i =0 ;i <(GodWeight.length);i++)
			totalWeight += GodWeight[i];
		for(var i =0 ;i <(GodWeight.length);i++)
			Godprobability[i] = GodWeight[i]/totalWeight;
		var precision = 10^Math.ceil(log10(totalWeight));
		var lottery = false;
		var j = Math.floor(Math.random()*GodWeight.length);
		var randI = Math.floor((Math.random()*precision)+1);
		var pero = Math.floor(precision - (Godprobability[j] * precision));
		if (randI > pero){
			lottery = true;
			itemId = GodWeights[j];
			break;
		}
		if (GodWeight.length == 0) {
			lottery = true;
			itemId = GodWeights[0];
			break;
		}
		GodWeight.splice(j-1,1);
	}
	if (itemId == "一班")
		累計一班 +=1;
	if (itemId == "稀有")
		累計稀有 +=1;
}

function start() {
    status = -1;
    action(1, 0, 0);
}

function action(mode, type, selection) {
    if (mode == 1) {
	status++;
    } else {
	cm.dispose();
		return ;
    }
    if (status == 0) {
		if (!cm.getPlayer().isAdmin()) {
			cm.sendOk("不好意思!管理員正在準備中。");
			cm.dispose();
			return ;
		}
		if (cm.getPlayer().getLevel() < 30) {
			cm.sendOk("你目前等級無法使用該功能");
			cm.dispose();
			return;
		}
		if (cm.haveItem(5220000)) {
			cm.sendYesNo("[#b#p" +cm.getNpc()+"##k]：\r\n您身上有 #b#t5220000##i5220000##k 可以進行轉蛋。\r\n\r\n" +
				"#L0##e#d你確定要使用嗎？#n#k#l\r\n" +
				"\r\n#r－－－－－－－－－－－－－－－－－－－－－－－－#k\r\n\r\n" +
				"#e本機台的捲軸..#n\r\n\r\n" + 
				"#e#r　　所有 #b卷軸將隨機抽到#r 1 - 3 #b張\r\n"
				);
		} else {
			cm.sendOk("不好意思!您沒有#b#t5220000##i5220000##k。");
			cm.safeDispose();
		}
    } else if (status == 1) {
		var item;
		//卷軸隨機 1-3 張
		var scroll_RandomQ = Math.floor(Math.random() * 3) + 1;
		var Select = Math.floor(Math.random() * 10);//0-9
		if (Select <= 1) {
			item = cm.gainGachaponItem(itemList15_65[Math.floor(Math.random() * itemList15_65.length)], scroll_RandomQ);
		} else if (Select >= 2 && Select <= 4) {
			item = cm.gainGachaponItem(itemList30_70[Math.floor(Math.random() * itemList30_70.length)], scroll_RandomQ);
		} else {
			item = cm.gainGachaponItem(itemList10_60[Math.floor(Math.random() * itemList10_60.length)], scroll_RandomQ);
		}
		if (item != -1) {
			cm.gainItem(5220000, -1);
			cm.sendOk("#e您已獲得 #b#i" + item + "##t" + item + "# #r" + scroll_RandomQ + "#k 張");
		} else {
			cm.sendOk("#e檢查一下#b背包#r是否已滿#k");
		}
	cm.safeDispose();
    }
}